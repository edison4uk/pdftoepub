<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW" class="h-full bg-gray-50"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;PDF 轉 EPUB 轉換器 (EPUB 2.0 相容版)&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 引入 Tailwind CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 引入 Google Fonts --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 自訂檔案上傳按鈕樣式 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.file-input-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: background-color 0.3s, border-color 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#pdfFile {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="h-full flex items-center justify-center p-4 bg-gray-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-10 border border-gray-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1 class="mt-4 text-2xl md:text-3xl font-bold tracking-tight text-gray-900"&gt;PDF 轉 EPUB 轉換器&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="mt-2 text-sm md:text-base text-gray-600"&gt;生成 EPUB 2.0 格式，相容於多數閱讀器，並自動建立目錄。&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mt-8 space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- 檔案上傳區域 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="upload-area" class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-8 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="pdfFile" class="mt-4 block text-sm font-medium text-indigo-600 hover:text-indigo-500 file-input-button"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span&gt;選擇一個 PDF 檔案&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="file" id="pdfFile" accept="application/pdf"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="file-name" class="mt-1 text-xs text-gray-500"&gt;或將檔案拖曳到此處&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- 轉換按鈕 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="convertBtn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400 disabled:cursor-not-allowed"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>開始轉換</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- 狀態與下載連結 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="status-container" class="text-center h-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="status" class="text-gray-700 font-medium"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;a id="downloadLink" class="hidden inline-block mt-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700"&gt;&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 引入函式庫 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// 設定 pdf.js 的 worker 路徑</p>
<p class="p1"><span class="Apple-converted-space">        </span>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 獲取 DOM 元素</p>
<p class="p1"><span class="Apple-converted-space">        </span>const pdfFileInput = document.getElementById('pdfFile');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const convertBtn = document.getElementById('convertBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const statusDiv = document.getElementById('status');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const downloadLink = document.getElementById('downloadLink');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const fileNameDisplay = document.getElementById('file-name');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const uploadArea = document.getElementById('upload-area');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let selectedFile = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 處理檔案選擇</p>
<p class="p1"><span class="Apple-converted-space">        </span>pdfFileInput.addEventListener('change', (event) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (event.target.files.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>selectedFile = event.target.files[0];</p>
<p class="p1"><span class="Apple-converted-space">                </span>fileNameDisplay.textContent = selectedFile.name;</p>
<p class="p1"><span class="Apple-converted-space">                </span>fileNameDisplay.classList.add('font-semibold', 'text-indigo-700');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 處理拖放功能</p>
<p class="p1"><span class="Apple-converted-space">        </span>['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>uploadArea.addEventListener(eventName, preventDefaults, false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function preventDefaults(e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">            </span>e.stopPropagation();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>['dragenter', 'dragover'].forEach(eventName =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>uploadArea.addEventListener(eventName, () =&gt; uploadArea.classList.add('border-indigo-500', 'bg-indigo-50'), false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>['dragleave', 'drop'].forEach(eventName =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>uploadArea.addEventListener(eventName, () =&gt; uploadArea.classList.remove('border-indigo-500', 'bg-indigo-50'), false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>uploadArea.addEventListener('drop', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const dt = e.dataTransfer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const files = dt.files;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (files.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const file = files[0];</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (file.type === 'application/pdf') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedFile = file;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fileNameDisplay.textContent = selectedFile.name;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fileNameDisplay.classList.add('font-semibold', 'text-indigo-700');</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fileNameDisplay.textContent = '請選擇 PDF 格式的檔案';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>fileNameDisplay.classList.add('text-red-500');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}, false);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 點擊轉換按鈕</p>
<p class="p1"><span class="Apple-converted-space">        </span>convertBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!selectedFile) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusDiv.textContent = '請先選擇一個 PDF 檔案！';</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusDiv.classList.add('text-red-500');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>convertBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>convertBtn.textContent = '轉換中...';</p>
<p class="p1"><span class="Apple-converted-space">            </span>downloadLink.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">            </span>statusDiv.classList.remove('text-red-500');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const fileReader = new FileReader();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>fileReader.onload = async function() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.textContent = '正在讀取 PDF...';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const typedarray = new Uint8Array(this.result);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const pdf = await pdfjsLib.getDocument(typedarray).promise;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.textContent = '正在解析內文並移除頁碼...';</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>let chapters = [];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const pagesPerChapter = 10; // 每 10 頁分割成一個章節</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let chapterPages = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>for (let i = 1; i &lt;= pdf.numPages; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const page = await pdf.getPage(i);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const viewport = page.getViewport({ scale: 1 });</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const textContent = await page.getTextContent();</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>const pageHeight = viewport.height;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const headerMargin = pageHeight * 0.1;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const footerMargin = pageHeight * 0.9;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>let pageItems = textContent.items.filter(item =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const y = item.transform[5];</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if (y &gt; headerMargin &amp;&amp; y &lt; footerMargin) {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>const trimmedText = item.str.trim();</p>
<p class="p1"><span class="Apple-converted-space">                                </span>return !/^\d+$/.test(trimmedText) || trimmedText.length &gt; 4;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>pageItems.sort((a, b) =&gt; b.transform[5] - a.transform[5]);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>let pageText = pageItems.map(item =&gt; item.str).join(' ').trim();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if(pageText) chapterPages.push(pageText);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (chapterPages.length &gt;= pagesPerChapter || i === pdf.numPages) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if(chapterPages.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>chapters.push(chapterPages.join('\n\n'));</p>
<p class="p1"><span class="Apple-converted-space">                                </span>chapterPages = [];</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>statusDiv.textContent = `處理中... ${i} / ${pdf.numPages} 頁`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.textContent = '正在生成 EPUB 2.0 檔案...';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const epubZip = await createEpub2(selectedFile.name.replace(/\.pdf$/i, ''), chapters);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const blob = await epubZip.generateAsync({ type: 'blob', mimeType: "application/epub+zip" });</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadLink.href = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadLink.download = selectedFile.name.replace(/\.pdf$/i, '.epub');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadLink.textContent = '轉換完成！點此下載 EPUB';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadLink.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadLink.style.display = 'inline-block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.textContent = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("轉換時發生錯誤:", error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.textContent = `發生錯誤：${error.message}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>statusDiv.classList.add('text-red-500');</p>
<p class="p1"><span class="Apple-converted-space">                </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>convertBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>convertBtn.textContent = '開始轉換';</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>fileReader.readAsArrayBuffer(selectedFile);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// EPUB 2.0 生成函數</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function createEpub2(title, chapters) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const zip = new JSZip();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const uuid = `urn:uuid:${crypto.randomUUID()}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 1. mimetype</p>
<p class="p1"><span class="Apple-converted-space">            </span>zip.file("mimetype", "application/epub+zip", { compression: "STORE" });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 2. META-INF/container.xml</p>
<p class="p1"><span class="Apple-converted-space">            </span>const containerXml = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p class="p1">&lt;container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;rootfiles&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/rootfiles&gt;</p>
<p class="p1">&lt;/container&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>zip.file("META-INF/container.xml", containerXml);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 3. OEBPS/stylesheet.css</p>
<p class="p1"><span class="Apple-converted-space">            </span>const css = `body { font-family: sans-serif; line-height: 1.6; } p { margin: 0 0 1em 0; text-indent: 2em; }`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>zip.file("OEBPS/stylesheet.css", css);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 4. 生成章節 XHTML 檔案</p>
<p class="p1"><span class="Apple-converted-space">            </span>chapters.forEach((content, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chapterId = index + 1;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const htmlContent = content.split('\n\n').map(p =&gt; `&lt;p&gt;${p.replace(/&amp;/g, '&amp;amp;').replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;')}&lt;/p&gt;`).join('\n');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const xhtml = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p class="p1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</p>
<p class="p1">&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;第 ${chapterId} 章&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="stylesheet" type="text/css" href="stylesheet.css"/&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>${htmlContent}</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>zip.file(`OEBPS/chapter${chapterId}.xhtml`, xhtml);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 5. 生成 toc.ncx (EPUB 2 目錄)</p>
<p class="p1"><span class="Apple-converted-space">            </span>let tocNcx = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p class="p1">&lt;!DOCTYPE ncx PUBLIC "-//NISO//DTD ncx 2005-1//EN" "http://www.daisy.org/z3986/2005/ncx-2005-1.dtd"&gt;</p>
<p class="p1">&lt;ncx xmlns="http://www.daisy.org/z3986/2005/ncx/" version="2005-1"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="dtb:uid" content="${uuid}"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="dtb:depth" content="1"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="dtb:totalPageCount" content="0"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="dtb:maxPageNumber" content="0"/&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;docTitle&gt;&lt;text&gt;${title}&lt;/text&gt;&lt;/docTitle&gt;</p>
<p class="p1">&lt;navMap&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>chapters.forEach((_, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chapterId = index + 1;</p>
<p class="p1"><span class="Apple-converted-space">                </span>tocNcx += `</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;navPoint id="navPoint-${chapterId}" playOrder="${chapterId}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;navLabel&gt;&lt;text&gt;第 ${chapterId} 章&lt;/text&gt;&lt;/navLabel&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;content src="chapter${chapterId}.xhtml"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/navPoint&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>tocNcx += `</p>
<p class="p1">&lt;/navMap&gt;</p>
<p class="p1">&lt;/ncx&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>zip.file("OEBPS/toc.ncx", tocNcx);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// 6. 生成 content.opf (EPUB 2 核心檔案)</p>
<p class="p1"><span class="Apple-converted-space">            </span>let contentOpf = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p class="p1">&lt;package xmlns="http://www.idpf.org/2007/opf" unique-identifier="BookId" version="2.0"&gt;</p>
<p class="p1">&lt;metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opf="http://www.idpf.org/2007/opf"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;dc:title&gt;${title}&lt;/dc:title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;dc:language&gt;zh-TW&lt;/dc:language&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;dc:identifier id="BookId" opf:scheme="UUID"&gt;${uuid}&lt;/dc:identifier&gt;</p>
<p class="p1">&lt;/metadata&gt;</p>
<p class="p1">&lt;manifest&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;item id="css" href="stylesheet.css" media-type="text/css"/&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>chapters.forEach((_, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chapterId = index + 1;</p>
<p class="p1"><span class="Apple-converted-space">                </span>contentOpf += `</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;item id="chapter${chapterId}" href="chapter${chapterId}.xhtml" media-type="application/xhtml+xml"/&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>contentOpf += `</p>
<p class="p1">&lt;/manifest&gt;</p>
<p class="p1">&lt;spine toc="ncx"&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>chapters.forEach((_, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chapterId = index + 1;</p>
<p class="p1"><span class="Apple-converted-space">                </span>contentOpf += `</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;itemref idref="chapter${chapterId}"/&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>contentOpf += `</p>
<p class="p1">&lt;/spine&gt;</p>
<p class="p1">&lt;/package&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>zip.file("OEBPS/content.opf", contentOpf);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>return zip;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
